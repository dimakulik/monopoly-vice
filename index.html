<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>monopoly_tg</title>
  <style>
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#232a2f;
      color:#fff;
      overflow:hidden;
    }

    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);
    }

    /* DESKTOP layout */
    .app{
      height:100%;
      display:grid;
      grid-template-columns:320px 1fr;
    }

    /* LEFT players */
    .left{
      background:#1b2024;
      padding:18px 14px;
      display:flex;
      flex-direction:column;
      gap:18px;
      overflow:hidden;
    }
    .pcard{
      background:#20262b;
      border-radius:0;
      padding:16px;
    }
    .pcard.red{ background:#e45656; }
    .ava{ width:70px; height:70px; border-radius:50%; background:#444; margin:6px auto 10px; }
    .ring-green{ outline:4px solid #33d46a; }
    .ring-blue{ outline:4px solid #3aa7ff; }
    .ring-purple{ outline:4px solid #b17cff; }
    .pname{ text-align:center; font-weight:800; margin-bottom:6px; }
    .pmoney{ text-align:center; font-size:28px; font-weight:900; }

    /* MID */
    .mid{
      position:relative;
      background:#2a3136;
      overflow:hidden;
    }

    .stage{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:calc(12px + var(--safe-top)) 12px calc(12px + var(--safe-bottom)) 12px;
    }

    /* board holder */
    #boardWrap{
      position:relative;
      width:600px;
      height:600px;
      background:#0f0f12;
      box-shadow:0 0 0 2px rgba(255,255,255,0.06) inset;
    }
    canvas{display:block; width:100%; height:100%;}

    /* HUD diagnostic */
    #hud{
      position:fixed;
      left:10px;
      bottom:10px;
      z-index:9999;
      background:rgba(0,0,0,0.55);
      padding:8px 10px;
      border-radius:10px;
      font:600 12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      pointer-events:none;
      white-space:pre;
      max-width:90vw;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* CHAT */
    .chatBar{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:12px;
      width:70%;
      height:52px;
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 10px;
      background:#2f363b;
      z-index:5;
    }
    .scopeBtn{border:0;background:#3b4146;color:#fff;height:34px;padding:0 10px;font-weight:800;border-radius:4px;}
    #msg{flex:1;height:34px;border:0;outline:none;background:#2f363b;color:#cfd6db;font-size:16px;}
    .icons{display:flex;gap:12px;align-items:center;color:#cfd6db;font-size:18px;}

    /* =======================
       MOBILE: 2 columns (players + board), NO OVERLAP
       ======================= */
@media (max-width: 900px){
  .app{
    grid-template-columns:128px 1fr;
    align-items:center;                 /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
  }

  /* –¥–µ–ª–∞–µ–º –∫–æ–ª–æ–Ω–∫—É –∏–≥—Ä–æ–∫–æ–≤ —Ç–∞–∫–æ–π –∂–µ –≤—ã—Å–æ—Ç—ã –∫–∞–∫ –ø–æ–ª–µ */
  .left{
    padding:calc(10px + var(--safe-top)) 8px calc(10px + var(--safe-bottom)) 8px;
    background:transparent;
    gap:10px;
    overflow:auto;                      /* –µ—Å–ª–∏ –∏–≥—Ä–æ–∫–æ–≤ –º–Ω–æ–≥–æ ‚Äî —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ */
    height:var(--board-side);           /* –í–ê–ñ–ù–û: –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç–æ–π –ø–æ–ª—è */
    align-self:center;
  }

  /* –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
  .pcard{
    width:100%;
    border-radius:14px;
    padding:10px;
  }
  .pmoney{ font-size:14px; line-height:1; }
  .pname{ font-size:12px; line-height:1.1; }
  .ava{ width:40px; height:40px; margin:0 auto 6px; }

  .stage{
    padding:calc(10px + var(--safe-top)) 10px calc(10px + var(--safe-bottom)) 10px;
    justify-content:center;
  }
  .chatBar{ width:88%; }
}

  </style>
</head>

<body>
  <div class="app">
    <aside class="left">
      <div class="pcard red">
        <div class="ava"></div>
        <div class="pname">Shnurok</div>
        <div class="pmoney">$ 15,000k</div>
      </div>

      <div class="pcard">
        <div class="ava ring-green"></div>
        <div class="pname">dimakulik</div>
        <div class="pmoney">$ 15,000k</div>
      </div>

      <div class="pcard">
        <div class="ava ring-blue"></div>
        <div class="pname">‚≠ê –î–∏–º–∞</div>
        <div class="pmoney">$ 15,000k</div>
      </div>

      <div class="pcard">
        <div class="ava ring-purple"></div>
        <div class="pname">‚≠ê Morpheus</div>
        <div class="pmoney">$ 15,000k</div>
      </div>
    </aside>

    <main class="mid">
      <div class="stage">
        <div id="boardWrap">
          <canvas id="board"></canvas>
          <div class="chatBar">
            <button class="scopeBtn">–í—Å–µ–º</button>
            <input id="msg" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" />
            <div class="icons"><span>üò∫</span><span>‚õ∂</span><span>‚åÉ</span></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <div id="hud">HUD</div>

  <script>
    const hud = document.getElementById("hud");
    const wrap = document.getElementById("boardWrap");
    const canvas = document.getElementById("board");
    const ctx = canvas.getContext("2d");

    function vp(){
      const vv = window.visualViewport;
      const cw = document.documentElement.clientWidth;
      const ch = document.documentElement.clientHeight;
      return {
        w: Math.round(vv ? vv.width : cw),
        h: Math.round(vv ? vv.height : ch),
        scale: vv ? vv.scale : 1
      };
    }

    function setHud(extra=""){
      const v = vp();
      const dpr = window.devicePixelRatio || 1;
      hud.textContent =
`vw/vh: ${v.w}√ó${v.h}  vv.scale:${v.scale}
wrap: ${Math.round(wrap.getBoundingClientRect().width)}√ó${Math.round(wrap.getBoundingClientRect().height)}
canvas: ${canvas.width}√ó${canvas.height} (css ${Math.round(canvas.getBoundingClientRect().width)}√ó${Math.round(canvas.getBoundingClientRect().height)}) dpr:${dpr}
${extra}`.trim();
    }

    function computeSide(){
      const v = vp();
      const isMobile = v.w <= 900;

      if(isMobile){
        // –Ω–∞ –º–æ–±–∏–ª–∫–µ: –º–µ—Å—Ç–æ –ø–æ–¥ –∏–≥—Ä–æ–∫–æ–≤ —É–∂–µ –µ—Å—Ç—å (128px), –±–µ—Ä–µ–º —à–∏—Ä–∏–Ω—É mid
        const midWidth = document.querySelector(".mid").getBoundingClientRect().width;
        const side = Math.floor(Math.min(midWidth * 0.98, v.h * 0.82));
        return Math.max(280, side);
      }else{
        const side = Math.floor(Math.min((v.w - 320) * 0.92, v.h * 0.92, 920));
        return Math.max(520, side);
      }
    }

    function resizeCanvasTo(side){
      wrap.style.width = side + "px";
      wrap.style.height = side + "px";

      const dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
      canvas.style.width = side + "px";
      canvas.style.height = side + "px";
      canvas.width = Math.round(side * dpr);
      canvas.height = Math.round(side * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }

    function drawTest(){
      const side = wrap.getBoundingClientRect().width;
      ctx.clearRect(0,0,side,side);

      ctx.fillStyle = "#0f0f12";
      ctx.fillRect(0,0,side,side);

      ctx.strokeStyle = "#ffffff";
      ctx.lineWidth = 2;
      ctx.strokeRect(1,1,side-2,side-2);

      ctx.fillStyle = "#3a4248";
      const pad = side * 0.18;
      ctx.fillRect(pad,pad,side-2*pad,side-2*pad);

      ctx.strokeStyle = "rgba(255,255,255,0.15)";
      ctx.lineWidth = 1;
      const step = side/10;
      for(let i=1;i<10;i++){
        ctx.beginPath(); ctx.moveTo(i*step,0); ctx.lineTo(i*step,side); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,i*step); ctx.lineTo(side,i*step); ctx.stroke();
      }

      ctx.fillStyle="#fff";
      ctx.font="800 18px system-ui";
      ctx.fillText("CANVAS OK", 14, 26);
    }

    function render(extra=""){
      try{
        const side = computeSide();
        resizeCanvasTo(side);
        drawTest();
        setHud(extra);
      }catch(e){
        setHud("ERROR: " + (e && e.message ? e.message : e));
      }
    }

    function renderHard(){
      render("renderHard()");
      setTimeout(()=>render("t+80ms"), 80);
      setTimeout(()=>render("t+220ms"), 220);
      setTimeout(()=>render("t+520ms"), 520);
    }

    window.addEventListener("resize", renderHard);
    window.addEventListener("orientationchange", ()=>setTimeout(renderHard, 200));
    if(window.visualViewport){
      window.visualViewport.addEventListener("resize", renderHard);
      window.visualViewport.addEventListener("scroll", renderHard);
    }

    renderHard();
  </script>
</body>
</html>
